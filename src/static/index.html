<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media RSS Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Manrope:wght@400;500;700&family=IBM+Plex+Sans:wght@400;500;700&family=Plus+Jakarta+Sans:wght@400;500;700&family=Sora:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="icon" type="image/png" sizes="32x32" href="/static/Video-Download.png">
    <style>
        :root {
            --bg-a: #f6fbff;
            --bg-b: #fef7ef;
            --ink: #172133;
            --muted: #56627a;
            --panel: #ffffff;
            --line: #d8e0ef;
            --brand: #0f6ef5;
            --brand-dark: #0c58c2;
            --danger: #d94848;
            --warn: #d97706;
            --ok: #15803d;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: var(--app-font, "Space Grotesk"), "Noto Sans SC", ui-sans-serif, system-ui, sans-serif;
            color: var(--ink);
            background:
                radial-gradient(1000px 350px at 0% 0%, #dbeeff 0%, rgba(219, 238, 255, 0) 70%),
                radial-gradient(900px 380px at 100% 0%, #ffe8cb 0%, rgba(255, 232, 203, 0) 70%),
                linear-gradient(160deg, var(--bg-a), var(--bg-b));
            min-height: 100vh;
        }

        .card-enter {
            animation: card-enter 0.35s ease-out;
        }

        @keyframes card-enter {
            from {
                transform: translateY(6px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script src="/api/constants.js"></script>
    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const GC = window.GENERAL_CONSTANTS || { APP: {}, DEFAULTS: {}, STRINGS: {}, LISTS: {} };
        const FONT_OPTIONS = GC.LISTS?.FONT_OPTIONS || [];
        const PT_SITE_TAG_COLORS = GC.LISTS?.PT_SITE_TAG_COLORS || {};

        const ui = {
            btn: "px-3 py-2 rounded-lg text-sm font-medium transition-colors",
            btnGhost: "border border-slate-300 bg-white hover:bg-slate-50",
            btnPrimary: "bg-blue-600 text-white hover:bg-blue-700",
            btnWarn: "bg-amber-500 text-white hover:bg-amber-600",
            btnDanger: "bg-red-600 text-white hover:bg-red-700",
            panel: "rounded-2xl border border-slate-200 bg-white/90 shadow-sm",
            input: "w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-100"
        };

        function MetricCard({ label, value, hint }) {
            return (
                <div className={`${ui.panel} card-enter p-4`}>
                    <div className="text-xs uppercase tracking-wide text-slate-500">{label}</div>
                    <div className="mt-1 text-2xl font-bold text-slate-800">{value}</div>
                    <div className="mt-1 text-xs text-slate-500">{hint}</div>
                </div>
            );
        }

        function FeedRow({ feed, onEdit, onCheck, onLogs, onDelete }) {
            const ptTagClass = (site) => {
                const normalized = String(site || "").toLowerCase();
                return PT_SITE_TAG_COLORS[normalized] || PT_SITE_TAG_COLORS.default || "border-slate-300 bg-slate-100 text-slate-700";
            };

            return (
                <div className="card-enter rounded-xl border border-slate-200 bg-white p-4">
                    <div className="flex flex-col gap-3 lg:flex-row lg:items-start lg:justify-between">
                        <div className="min-w-0 flex-1">
                            <div className="flex flex-wrap items-center gap-2">
                                <span className={`inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-bold tracking-wide ${ptTagClass(feed.pt_site)}`}>{feed.pt_site || "PT"}</span>
                                <div className="text-base font-semibold text-slate-800">{feed.name}</div>
                            </div>
                            <div className="mt-1 text-xs text-slate-500">RSS ID: {feed.id}</div>
                            <div className="mt-2 flex flex-wrap gap-x-4 gap-y-1 text-sm text-slate-600">
                                <span>Interval: {feed.interval} min</span>
                                <span>Last check: {feed.lastChecked || "-"}</span>
                                <span>Status: {feed.lastStatus || "-"}</span>
                            </div>
                        </div>
                        <div className="grid grid-cols-2 gap-2 sm:flex sm:flex-col sm:w-24">
                            <button onClick={onEdit} className={`${ui.btn} bg-slate-200 text-slate-800 hover:bg-slate-300`}>Edit</button>
                            <button onClick={onCheck} className={`${ui.btn} ${ui.btnWarn}`}>Check</button>
                            <button onClick={onLogs} className={`${ui.btn} ${ui.btnGhost}`}>Logs</button>
                            <button onClick={onDelete} className={`${ui.btn} ${ui.btnDanger}`}>Delete</button>
                        </div>
                    </div>
                </div>
            );
        }

        function RssTransmissionManager() {
            const PAGE_TITLE = GC.STRINGS.TITLE || "Media RSS Management";
            const FONT_STORAGE_KEY = GC.DEFAULTS?.UI_FONT_STORAGE_KEY || "mm_font";
            const DEFAULT_FONT_ID = GC.DEFAULTS?.UI_DEFAULT_FONT_ID || "space";
            const [feeds, setFeeds] = useState([]);
            const [loading, setLoading] = useState(false);
            const [showForm, setShowForm] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [editing, setEditing] = useState(null);
            const [appVersion, setAppVersion] = useState(GC.APP?.VERSION || "0.0.0");
            const [fontId, setFontId] = useState(localStorage.getItem(FONT_STORAGE_KEY) || DEFAULT_FONT_ID);
            const [form, setForm] = useState({
                name: "",
                url: "",
                pt_site: (GC.LISTS?.PT_SITES?.[0]) || "",
                key_words: "",
                path: "",
                set_default_download: false,
                interval: GC.DEFAULTS.DEFAULT_RSS_INTERVAL || 10
            });
            const [settings, setSettings] = useState({
                transmission_url: GC.DEFAULTS.TRANSMISSION_URL || "",
                transmission_port: GC.DEFAULTS.TRANSMISSION_PORT || 9091,
                username: "",
                password: "",
                default_rss_interval: GC.DEFAULTS.DEFAULT_RSS_INTERVAL || 10
            });
            const [settingsErrors, setSettingsErrors] = useState({});
            const [selectedLogs, setSelectedLogs] = useState([]);
            const [logFeed, setLogFeed] = useState(null);
            const [toast, setToast] = useState(null);
            const pollRef = useRef(null);

            const stats = useMemo(() => {
                const total = feeds.length;
                const checked = feeds.filter((f) => !!f.lastChecked).length;
                const withKeywords = feeds.filter((f) => !!(f.key_words && f.key_words.trim())).length;
                return { total, checked, withKeywords };
            }, [feeds]);

            useEffect(() => {
                const title = PAGE_TITLE;
                document.title = `${title} v${appVersion}`;
                fetchFeeds();
                fetchSettings();
                fetchVersion();
                startPollingStatus();
                return stopPollingStatus;
            }, []);

            useEffect(() => {
                applyFont(fontId);
            }, [fontId]);

            function applyFont(id) {
                const selected = FONT_OPTIONS.find((f) => f.id === id) || FONT_OPTIONS[0];
                if (!selected) return;
                document.documentElement.style.setProperty("--app-font", selected.value);
                localStorage.setItem(FONT_STORAGE_KEY, selected.id);
            }

            async function fetchVersion() {
                try {
                    const res = await fetch("/api/version", {
                        cache: "no-cache",
                        headers: { "Cache-Control": "no-cache" }
                    });
                    if (!res.ok) throw new Error(await res.text());
                    const data = await res.json();
                    if (data?.version) {
                        setAppVersion(data.version);
                        const title = PAGE_TITLE;
                        document.title = `${title} v${data.version}`;
                    }
                } catch (e) {
                    console.error("Failed to fetch app version", e);
                }
            }

            function startPollingStatus() {
                pollRef.current = setInterval(() => {
                    fetchFeeds(true);
                }, GC.DEFAULTS.AUTO_REFRESH_MS || 15000);
            }

            function stopPollingStatus() {
                if (pollRef.current) clearInterval(pollRef.current);
            }

            async function fetchFeeds(silent = false) {
                if (!silent) setLoading(true);
                try {
                    const res = await fetch("/api/feeds", {
                        cache: "no-cache",
                        headers: { "Cache-Control": "no-cache" }
                    });
                    if (!res.ok) throw new Error(await res.text());
                    const data = await res.json();
                    setFeeds(data);
                } catch (e) {
                    console.error(e);
                    if (!silent) showToast(`${GC.STRINGS.FAILED_LOAD_FEEDS}: ${e.message}`, "error");
                }
                if (!silent) setLoading(false);
            }

            function showToast(msg, type = "info") {
                setToast({ msg, type });
                setTimeout(() => setToast(null), 3500);
            }

            async function fetchSettings() {
                try {
                    const res = await fetch("/api/settings");
                    if (!res.ok) throw new Error(await res.text());
                    const data = await res.json();
                    setSettings(data);
                } catch (e) {
                    console.error(e);
                }
            }

            function validateSettings() {
                const errors = {};
                if (!Number.isInteger(Number(settings.transmission_port)) || Number(settings.transmission_port) < 1 || Number(settings.transmission_port) > 65535) {
                    errors.transmission_port = "Port must be an integer between 1 and 65535";
                }
                if (settings.default_rss_interval < 5) {
                    errors.default_rss_interval = "Default interval must be at least 5 minutes";
                }
                if (settings.default_rss_interval > 1440) {
                    errors.default_rss_interval = "Default interval cannot exceed 1440 minutes";
                }
                setSettingsErrors(errors);
                return Object.keys(errors).length === 0;
            }

            async function saveSettings(e) {
                e.preventDefault();
                if (!validateSettings()) {
                    showToast(GC.STRINGS.FIX_ERRORS, "error");
                    return;
                }
                try {
                    const res = await fetch("/api/settings", {
                        method: "POST",
                        headers: { "content-type": "application/json" },
                        body: JSON.stringify(settings)
                    });
                    if (!res.ok) {
                        const errorData = await res.json();
                        throw new Error(errorData.detail || await res.text());
                    }
                    showToast(GC.STRINGS.SETTINGS_SAVED, "success");
                    setShowSettings(false);
                    await fetchFeeds();
                } catch (e) {
                    showToast(`${GC.STRINGS.SAVE_FAILED}: ${e.message}`, "error");
                }
            }

            function openNew() {
                setEditing(null);
                const shouldCheck = !settings.default_download_path || settings.default_download_path === "";
                setForm({
                    name: "",
                    url: "",
                    pt_site: (GC.LISTS?.PT_SITES?.[0]) || "",
                    key_words: "",
                    path: "",
                    set_default_download: shouldCheck,
                    interval: settings.default_rss_interval || 10
                });
                setShowForm(true);
            }

            function openEdit(f) {
                setEditing(f);
                const shouldCheck = !settings.default_download_path || settings.default_download_path === "";
                setForm({
                    name: f.name,
                    url: f.url,
                    pt_site: f.pt_site || ((GC.LISTS?.PT_SITES?.[0]) || ""),
                    key_words: f.key_words || "",
                    path: f.path || "",
                    set_default_download: shouldCheck,
                    interval: f.interval
                });
                setShowForm(true);
            }

            async function submitForm(e) {
                e.preventDefault();
                try {
                    const method = editing ? "PUT" : "POST";
                    const url = editing ? `/api/feeds/${editing.id}` : "/api/feeds";
                    const res = await fetch(url, {
                        method,
                        headers: { "content-type": "application/json" },
                        body: JSON.stringify(form)
                    });
                    if (!res.ok) {
                        const errorData = await res.json().catch(async () => ({ detail: await res.text() }));
                        throw new Error(errorData.detail || "Save failed");
                    }
                    await fetchFeeds();
                    setShowForm(false);
                    showToast(editing ? GC.STRINGS.FEED_UPDATED : GC.STRINGS.FEED_ADDED, "success");
                } catch (e) {
                    showToast(`${GC.STRINGS.SAVE_FAILED}: ${e.message}`, "error");
                }
            }

            async function removeFeed(id) {
                if (!confirm(GC.STRINGS.CONFIRM_DELETE)) return;
                try {
                    const res = await fetch(`/api/feeds/${id}`, { method: "DELETE" });
                    if (!res.ok) throw new Error(await res.text());
                    await fetchFeeds();
                    showToast(GC.STRINGS.DELETED, "success");
                } catch (e) {
                    showToast(`${GC.STRINGS.DELETE_FAILED}: ${e.message}`, "error");
                }
            }

            async function triggerCheck(id) {
                try {
                    const res = await fetch(`/api/feeds/${id}/check`, { method: "POST" });
                    if (!res.ok) throw new Error(await res.text());
                    const data = await res.json();
                    showToast(`${GC.STRINGS.CHECK_DONE}: ${data.newItems?.length || 0}`, "success");
                    await fetchFeeds();
                } catch (e) {
                    showToast(`${GC.STRINGS.CHECK_FAILED}: ${e.message}`, "error");
                }
            }

            async function openLogs(id) {
                setLogFeed(id);
                try {
                    const res = await fetch(`/api/feeds/${id}/logs`);
                    if (!res.ok) throw new Error(await res.text());
                    const data = await res.json();
                    setSelectedLogs(data);
                } catch (e) {
                    showToast(`${GC.STRINGS.LOAD_LOGS_FAILED}: ${e.message}`, "error");
                }
            }

            return (
                <div className="mx-auto w-full max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
                    <header className={`${ui.panel} card-enter mb-5 p-5`}>
                        <div className="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
                            <div>
                                <h1 className="text-3xl font-bold text-slate-900">{PAGE_TITLE}</h1>
                                <div className="mt-1 inline-block rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">Version v{appVersion}</div>
                                <p className="mt-1 text-sm text-slate-500">Manage RSS feeds, checks, and Transmission settings in one place.</p>
                            </div>
                            <div className="grid grid-cols-2 gap-2 sm:flex">
                                <select
                                    value={fontId}
                                    onChange={(e) => setFontId(e.target.value)}
                                    className="rounded-lg border border-slate-300 bg-white px-2 py-2 text-sm text-slate-700"
                                    title="Font"
                                >
                                    {FONT_OPTIONS.map((f) => (
                                        <option key={f.id} value={f.id}>{f.label}</option>
                                    ))}
                                </select>
                                <button onClick={() => setShowSettings(true)} className={`${ui.btn} bg-slate-200 text-slate-800 hover:bg-slate-300`}>{GC.STRINGS.SETTINGS}</button>
                                <button onClick={openNew} className={`${ui.btn} ${ui.btnPrimary}`}>{GC.STRINGS.ADD_FEED}</button>
                                <button onClick={fetchFeeds} className={`${ui.btn} ${ui.btnGhost}`}>{GC.STRINGS.REFRESH}</button>
                            </div>
                        </div>
                    </header>

                    <section className="mb-5 grid grid-cols-1 gap-3 sm:grid-cols-3">
                        <MetricCard label="Total Feeds" value={stats.total} hint="All configured RSS sources" />
                        <MetricCard label="Checked" value={stats.checked} hint="Feeds with at least one check" />
                        <MetricCard label="Keyword Filters" value={stats.withKeywords} hint="Feeds using keyword filtering" />
                    </section>

                    <section className={`${ui.panel} p-4 sm:p-5`}>
                        <div className="mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                            <h2 className="text-lg font-semibold text-slate-900">{GC.STRINGS.FEEDS_HEADER}</h2>
                            <div className="text-xs text-slate-500">{GC.STRINGS.AUTO_REFRESH_MSG}</div>
                        </div>

                        {loading ? (
                            <div className="rounded-lg border border-dashed border-slate-300 p-8 text-center text-slate-500">{GC.STRINGS.LOADING}</div>
                        ) : (
                            <div className="space-y-3">
                                {feeds.length === 0 && (
                                    <div className="rounded-lg border border-dashed border-slate-300 p-8 text-center text-slate-500">{GC.STRINGS.NO_FEEDS}</div>
                                )}
                                {feeds.map((feed) => (
                                    <FeedRow
                                        key={feed.id}
                                        feed={feed}
                                        onEdit={() => openEdit(feed)}
                                        onCheck={() => triggerCheck(feed.id)}
                                        onLogs={() => openLogs(feed.id)}
                                        onDelete={() => removeFeed(feed.id)}
                                    />
                                ))}
                            </div>
                        )}
                    </section>

                    {showForm && (
                        <div className="fixed inset-0 z-40 flex items-center justify-center bg-black/45 p-4">
                            <form onSubmit={submitForm} className="w-full max-w-xl rounded-2xl border border-slate-200 bg-white p-6 shadow-2xl">
                                <h3 className="mb-4 text-xl font-semibold text-slate-900">{editing ? GC.STRINGS.BTN_EDIT : GC.STRINGS.ADD_FEED}</h3>

                                <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
                                    <div className="sm:col-span-1">
                                        <label className="mb-1 block text-sm font-medium text-slate-700">{GC.STRINGS.NAME_LABEL}</label>
                                        <input required className={ui.input} value={form.name} onChange={(e) => setForm({ ...form, name: e.target.value })} />
                                    </div>
                                    <div className="sm:col-span-1">
                                        <label className="mb-1 block text-sm font-medium text-slate-700">PT Site</label>
                                        <select className={ui.input} value={form.pt_site} onChange={(e) => setForm({ ...form, pt_site: e.target.value })}>
                                            {(GC.LISTS?.PT_SITES || []).map((s, idx) => (<option key={idx} value={s}>{s}</option>))}
                                        </select>
                                    </div>
                                </div>

                                <div className="mt-4">
                                    <label className="mb-1 block text-sm font-medium text-slate-700">{GC.STRINGS.RSS_URL_LABEL}</label>
                                    <input required className={ui.input} value={form.url} onChange={(e) => setForm({ ...form, url: e.target.value })} />
                                </div>

                                <div className="mt-4">
                                    <label className="mb-1 block text-sm font-medium text-slate-700">Keywords</label>
                                    <input className={ui.input} value={form.key_words} onChange={(e) => setForm({ ...form, key_words: e.target.value })} placeholder="keyword groups, separated by semicolon (optional)" />
                                </div>

                                <div className="mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2">
                                    <div>
                                        <label className="mb-1 block text-sm font-medium text-slate-700">{GC.STRINGS.PATH_LABEL}</label>
                                        <input className={ui.input} value={form.path} onChange={(e) => setForm({ ...form, path: e.target.value })} placeholder={GC.STRINGS.PLACEHOLDER_PATH} />
                                        {settings.default_download_path && (
                                            <div className="mt-1 text-xs text-slate-500">Default path: {settings.default_download_path}</div>
                                        )}
                                    </div>
                                    <div>
                                        <label className="mb-1 block text-sm font-medium text-slate-700">{GC.STRINGS.INTERVAL_LABEL}</label>
                                        <input type="number" min={1} className={ui.input} value={form.interval} onChange={(e) => setForm({ ...form, interval: Number(e.target.value) })} />
                                    </div>
                                </div>

                                <label className="mt-4 inline-flex items-center gap-2 text-sm text-slate-700">
                                    <input type="checkbox" checked={form.set_default_download} onChange={(e) => setForm({ ...form, set_default_download: e.target.checked })} />
                                    Set this path as default download path
                                </label>

                                <div className="mt-6 flex justify-end gap-2">
                                    <button type="button" onClick={() => setShowForm(false)} className={`${ui.btn} ${ui.btnGhost}`}>{GC.STRINGS.CANCEL_BUTTON}</button>
                                    <button type="submit" className={`${ui.btn} ${ui.btnPrimary}`}>{GC.STRINGS.SAVE_BUTTON}</button>
                                </div>
                            </form>
                        </div>
                    )}

                    {showSettings && (
                        <div className="fixed inset-0 z-40 flex items-center justify-center bg-black/45 p-4">
                            <form onSubmit={saveSettings} className="w-full max-w-xl rounded-2xl border border-slate-200 bg-white p-6 shadow-2xl">
                                <h3 className="mb-4 text-xl font-semibold text-slate-900">{GC.STRINGS.SETTINGS}</h3>

                                <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
                                    <div>
                                        <label className="mb-1 block text-sm font-medium text-slate-700">{GC.STRINGS.TRANSMISSION_RPC_LABEL}</label>
                                        <input
                                            type="text"
                                            className={`${ui.input} ${settingsErrors.transmission_url ? "border-red-500" : ""}`}
                                            value={settings.transmission_url}
                                            onChange={(e) => { setSettings({ ...settings, transmission_url: e.target.value }); setSettingsErrors({ ...settingsErrors, transmission_url: null }); }}
                                            placeholder={GC.STRINGS.PLACEHOLDER_TRANS_URL}
                                        />
                                        {settingsErrors.transmission_url && <div className="mt-1 text-xs text-red-500">{settingsErrors.transmission_url}</div>}
                                    </div>

                                    <div>
                                        <label className="mb-1 block text-sm font-medium text-slate-700">{GC.STRINGS.TRANSMISSION_PORT_LABEL}</label>
                                        <input
                                            type="number"
                                            min="1"
                                            max="65535"
                                            className={ui.input}
                                            value={settings.transmission_port}
                                            onChange={(e) => setSettings({ ...settings, transmission_port: e.target.value })}
                                            placeholder={`${GC.DEFAULTS.TRANSMISSION_PORT}`}
                                        />
                                    </div>
                                </div>

                                <div className="mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2">
                                    <div>
                                        <label className="mb-1 block text-sm font-medium text-slate-700">{GC.STRINGS.USERNAME_LABEL}</label>
                                        <input
                                            type="text"
                                            className={ui.input}
                                            value={settings.username}
                                            onChange={(e) => setSettings({ ...settings, username: e.target.value })}
                                            placeholder="optional"
                                        />
                                    </div>
                                    <div>
                                        <label className="mb-1 block text-sm font-medium text-slate-700">{GC.STRINGS.PASSWORD_LABEL}</label>
                                        <input
                                            type="password"
                                            className={ui.input}
                                            value={settings.password}
                                            onChange={(e) => setSettings({ ...settings, password: e.target.value })}
                                            placeholder="optional"
                                        />
                                    </div>
                                </div>

                                <div className="mt-4">
                                    <label className="mb-1 block text-sm font-medium text-slate-700">{GC.STRINGS.DEFAULT_RSS_INTERVAL_LABEL}</label>
                                    <input
                                        type="number"
                                        min="5"
                                        max="1440"
                                        className={`${ui.input} ${settingsErrors.default_rss_interval ? "border-red-500" : ""}`}
                                        value={settings.default_rss_interval}
                                        onChange={(e) => { setSettings({ ...settings, default_rss_interval: Number(e.target.value) }); setSettingsErrors({ ...settingsErrors, default_rss_interval: null }); }}
                                    />
                                    {settingsErrors.default_rss_interval && <div className="mt-1 text-xs text-red-500">{settingsErrors.default_rss_interval}</div>}
                                    <div className="mt-1 text-xs text-slate-500">Used as default interval for new RSS feeds</div>
                                </div>

                                <div className="mt-6 flex justify-end gap-2">
                                    <button type="button" onClick={() => { setShowSettings(false); setSettingsErrors({}); fetchSettings(); }} className={`${ui.btn} ${ui.btnGhost}`}>Cancel</button>
                                    <button type="submit" className={`${ui.btn} ${ui.btnPrimary}`}>Save</button>
                                </div>
                            </form>
                        </div>
                    )}

                    {logFeed && (
                        <div className="fixed inset-0 z-40 flex items-center justify-center bg-black/45 p-4">
                            <div className="w-full max-w-4xl rounded-2xl border border-slate-200 bg-white shadow-2xl">
                                <div className="flex items-center justify-between border-b border-slate-200 p-4">
                                    <h4 className="text-base font-semibold text-slate-900">Logs for feed {logFeed}</h4>
                                    <div className="flex gap-2">
                                        <button onClick={() => { setLogFeed(null); setSelectedLogs([]); }} className={`${ui.btn} ${ui.btnGhost}`}>{GC.STRINGS.BTN_CLOSE}</button>
                                        <button onClick={() => { navigator.clipboard.writeText(JSON.stringify(selectedLogs, null, 2)); showToast(GC.STRINGS.TOAST_COPIED, "success"); }} className={`${ui.btn} ${ui.btnGhost}`}>{GC.STRINGS.BTN_COPY}</button>
                                    </div>
                                </div>
                                <div className="max-h-[70vh] overflow-auto p-4 font-mono text-sm">
                                    {selectedLogs.length === 0 && <div className="text-slate-500">{GC.STRINGS.LOGS_NO}</div>}
                                    {selectedLogs.map((l, idx) => (
                                        <div key={idx} className="border-b border-slate-100 py-2">
                                            <div className="text-xs text-slate-400">{l.ts}</div>
                                            <div className="text-sm text-slate-800">[{l.level}] {l.msg}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {toast && (
                        <div className={`fixed bottom-6 right-6 z-50 rounded-lg px-4 py-3 text-sm font-medium shadow-lg ${toast.type === "error" ? "bg-red-600 text-white" : toast.type === "success" ? "bg-green-600 text-white" : "bg-slate-800 text-white"}`}>
                            {toast.msg}
                        </div>
                    )}
                </div>
            );
        }

        if (typeof React === "undefined" || typeof ReactDOM === "undefined") {
            document.getElementById("root").innerHTML = '<div style="padding: 20px; color: red;">Error: React libraries failed to load. Please check your internet connection.</div>';
        } else {
            try {
                if (ReactDOM.createRoot) {
                    const root = ReactDOM.createRoot(document.getElementById("root"));
                    root.render(<RssTransmissionManager />);
                } else {
                    ReactDOM.render(<RssTransmissionManager />, document.getElementById("root"));
                }
            } catch (error) {
                console.error("React rendering error:", error);
                document.getElementById("root").innerHTML = '<div style="padding: 20px; color: red;">Error rendering React component: ' + error.message + '</div>';
            }
        }
    </script>
</body>
</html>
